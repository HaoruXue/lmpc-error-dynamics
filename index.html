<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="description"
        content="Learning Model Predictive Control with Error Dynamics Regression for Autonomous Racing">
  <meta name="keywords" content="MPC, Reinforcement Learning, Optimal Control">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Learning MPC with Error Dynamics Regression for Autonomous Racing</title>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TXJ782DLPN"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-TXJ782DLPN');
</script>

  <link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro"
        rel="stylesheet">

  <link rel="stylesheet" href="./static/css/bulma.min.css">
  <link rel="stylesheet" href="./static/css/bulma-carousel.min.css">
  <link rel="stylesheet" href="./static/css/bulma-slider.min.css">
  <link rel="stylesheet" href="./static/css/fontawesome.all.min.css">
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
  <link rel="stylesheet" href="./static/css/index.css">
  <!-- <link rel="icon" href="./static/images/favicon.svg"> -->

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script defer src="./static/js/fontawesome.all.min.js"></script>
  <script src="./static/js/bulma-carousel.min.js"></script>
  <script src="./static/js/bulma-slider.min.js"></script>
  <script src="./static/js/index.js"></script>
</head>
<body>

<nav class="navbar" role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </a>
  </div>
  <div class="navbar-menu">
    <div class="navbar-start" style="flex-grow: 1; justify-content: center;">
      <a class="navbar-item" href="https://haoruxue.github.io/">
      <span class="icon">
          <i class="fas fa-home"></i>
      </span>
      </a>
      <!--
      <div class="navbar-item has-dropdown is-hoverable">
        <a class="navbar-link">
          More Research
        </a>
        <div class="navbar-dropdown">
          <a class="navbar-item" href="https://hypernerf.github.io">
            HyperNeRF
          </a>
          <a class="navbar-item" href="https://nerfies.github.io">
            Nerfies
          </a>
          <a class="navbar-item" href="https://latentfusion.github.io">
            LatentFusion
          </a>
          <a class="navbar-item" href="https://photoshape.github.io">
            PhotoShape
          </a>
        </div>
      </div>
    </div>
    -->

  </div>
</nav>


<section class="hero">
  <div class="hero-body">
    <div class="container is-max-desktop">
      <div class="columns is-centered">
        <div class="column has-text-centered">
          <h1 class="title is-1 publication-title">Learning Model Predictive Control <br>
            With Error Dynamics Regression <br>
            For Autonomous Racing</h1>
            <h2 class="subtitle">ICRA 2024</h2>
          <div class="is-size-5 publication-authors">
            <span class="author-block">
              <a href="https://haoruxue.github.io/">Haoru Xue</a><sup>1</sup>,</span>
            <span class="author-block">
              <a href="https://sites.google.com/view/edward-zhu/">Edward L. Zhu</a><sup>2</sup>,</span>
            <span class="author-block">
              <a href="https://www.ri.cmu.edu/ri-faculty/john-m-dolan/">John M. Dolan</a><sup>1</sup>,
            </span>
            <span class="author-block">
              <a href="https://me.berkeley.edu/people/francesco-borrelli/">Francesco Borrelli</a><sup>2</sup>
            </span>
          </div>

          <div class="is-size-5 publication-authors">
            <span class="author-block"><sup>1</sup>Carnegie Mellon University,</span>
            <span class="author-block"><sup>2</sup>UC Berkeley</span>
          </div>

          <div class="column has-text-centered">
            <div class="publication-links">
              <!-- PDF Link. -->
              <span class="link-block">
                <a href="https://arxiv.org/pdf/2309.10716"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fas fa-file-pdf"></i>
                  </span>
                  <span>Paper</span>
                </a>
              </span>
              <span class="link-block">
                <a href="https://arxiv.org/abs/2309.10716"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="ai ai-arxiv"></i>
                  </span>
                  <span>arXiv</span>
                </a>
              </span>
              <!-- Video Link. -->
              <span class="link-block">
                <a href="https://youtu.be/I2nQbDTGlpA?si=Sz5fUqL8mBJzLPn0"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fab fa-youtube"></i>
                  </span>
                  <span>Video</span>
                </a>
              </span>
              <!-- Code Link. -->
              <span class="link-block">
                <a href="https://github.com/MPC-Berkeley/Racing-LMPC-ROS2"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fab fa-github"></i>
                  </span>
                  <span>Code</span>
                  </a>
              </span>
              <!-- Dataset Link. -->
              <span class="link-block">
                <a href="https://youtu.be/o_tA-6iSN20?si=w2-OAIScOXrFv0BR"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                    <i class="fas fa-chalkboard-teacher"></i>
                  </span>
                  <span>Talk</span>
                  </a>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="hero teaser">
  <div class="container is-max-desktop">
    <div class="hero-body">
      <video id="teaser" controls muted loop playsinline height="100%">
        <source src="https://github.com/HaoruXue/Racing-LMPC-ROS2/assets/32390737/745e5f15-f159-42ad-be74-ac5673867a03"
                type="video/mp4">
      </video>
      <h2 class="subtitle has-text-centered">
        Learning MPC formulates real-world safe robot learning in an MPC paragidm. Error dynamics regression bridges the Sim2Real gap.
      </h2>
    </div>
  </div>
</section>

<section class="section">
  <div class="container is-max-desktop">
    <!-- Abstract. -->
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">Abstract</h2>
        <div class="content has-text-justified">
          <p>
          This work presents a novel Learning Model Predictive Control (LMPC) strategy
          for autonomous racing at the handling limit that can iteratively explore and
          learn unknown dynamics in high-speed operational domains. We start from existing
          LMPC formulations and  modify the system dynamics learning method. In particular,
          our approach uses a nominal, global, nonlinear, physics-based model with a local,
          linear, data-driven learning of the error dynamics. We conduct experiments in
          simulation, 1/10th scale hardware, and deployed the proposed LMPC on a full-scale
          autonomous race car used in the Indy Autonomous Challenge (IAC) with closed loop
          experiments at the Putnam Park Road Course in Indiana, USA.
        </p>
        <p>
        The results show that the proposed control policy  exhibits improved robustness to
        parameter tuning and data scarcity. Incremental and safety-aware exploration toward
        the limit of handling and iterative learning of the vehicle dynamics in high-speed domains
        is observed both in simulations and experiments.
        </p>
        </div>
      </div>
    </div>
    <!--/ Abstract. -->

    <!-- Paper video. -->
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">Talk</h2>
        <div class="publication-video">
          <iframe width="560" height="315" src="https://www.youtube.com/embed/o_tA-6iSN20?si=j1RDDEDApddVRuoa" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
        </div>
      </div>
    </div>
    <!--/ Paper video. -->
  </div>
</section>


<section class="section">
  <div class="container is-max-desktop">
    <!-- LMPC basics -->
    <div class="columns is-centered">
      <div class="column is-full-width">
        <h2 class="title is-3">Why Using Learning MPC for Roobot Learning</h2>

        <div class="content has-text-justified">
          <p>
            Learning MPC combines some of the best aspects of traditional and data-driven optimal control. On one side,
            we have a strong prior in the form of a physics-based model. On the other side, we have the flexibility of
            data-driven methods to learn the modeling error. This is complemented with some other things:
          </p>
          <ul>
            <li><b>Constraint reasoning:</b> MPC is good at solving with constraints.</li>
            <li><b>Policy learning:</b> not just for dynamics, LMPC embeds a policy learning tool as well, which is introduced below.</li>
            <li><b>Reference-free learning:</b> with a few demonstrations to get LMPC started, it can converge towards optimal policy
              without an explicit reference trajectory.</li>
          </ul>
          <p>
            Naturally, some learning tasks benifit more from LMPC. These are usually safety-critical or agile tasks in the real world.
            For example, autonomous racing, where the vehicle is operating at the limit of handling, is an interesting candidate for LMPC.
          </p>
        </div>
      </div>
    </div>
     <!-- LMPC basics -->
     <div class="columns is-centered">
      <div class="column is-full-width">
        <h2 class="title is-3">How Learning MPC Works</h2>

        <div class="content has-text-justified">
          <p>
            Learning MPC is a data-driven MPC method that uses previous experience to iteratively improve the control policy.
            It can also be augmented with regression to learn the dynamics of the system.
          </p>
        
          <img src="static/images/lmpc_eq.png" alt="Learning MPC with Error Dynamics Regression" style="width:30%;" class="is-centered">
        
          <p>
            Previous iterations of states and actions are stored in the sampled Safe Set (SS). Assuming a time-invariant environment,
            returning to the SS states will guarantee successful completion of the task - this is the control-invariance property of the SS.
            Therefore, we constrain the last state in the MPC horizon to be in the SS, which yields a iterative and safe exploration behavior
            around the SS. With the appropriate cost function, the control policy will learn to converge to the optimal policy.
          </p>
        </div>
      </div>
    </div>
    <!--/ LMPC basics -->

    <!-- LMPC basics -->
    <div class="columns is-centered">
      <div class="column is-full-width">
        <h2 class="title is-3">LMPC Can Also Learn Dynamics</h2>

        <div class="content has-text-justified">
          <p>
            We can query the SS to obtain neighboring states and actions to the robot's current state. We can then use this data to
            learn the dynamics of the system. This is done by fitting a linear model to the data, and has been attempted in
            <a href="https://doi.org/10.1109/TCST.2019.2948135">previous work</a>.
          </p>
        
          <p>
            Instead of doing a full regression to learn the entire dynamics, this work introduces a residual learning approach. The motivation
            is to leverage a prior model, either physics-based or learned-in-simulation. For the latter, this method helps bridge the Sim2Real gap. We hypothesize that this approach can be more data-efficient
            and robust to hyperparameter tunings.
          </p>

          <p>
            To formulate the A, B and C matrices for the DDP-based MPC, we first linearize the prior model to form the baseline prediction for these matrices.
            We then query the SS to obtain the residual dynamics, which is then added on top of the prior prediction. This is done by solving a weighted least-squares problem.
          </p>
  
          <img src="static/images/regression.png" alt="Learning MPC with Error Dynamics Regression" style="width:80%;" class="is-centered">

        </div>
      </div>
    </div>
    <!--/ LMPC basics -->

    <!-- LMPC basics -->
    <div class="columns is-centered">
      <div class="column is-full-width">
        <h2 class="title is-3">Results</h2>

        <div class="content has-text-justified">
          <p>
            Small-scale experiment on F1TENTH race cars shows that the proposed error-regression LMPC can learn the dynamics of the vehicle and converge to the optimal policy.
            Compared with the full-regression LMPC, the error-regression LMPC is more robust to hyperparameter tuning and data scarcity. The plot below compares
            the failure rate of the two methods. Full-regression LMPC fails 5 out of 10 trials with suboptimal hyperparameters, while the error-regression LMPC
            fails only 1 out of 10 trials.
          </p>
  
          <img src="static/images/fig_barc_per_lap_new.png" alt="Learning MPC with Error Dynamics Regression" style="width:70%;" class="is-centered">

          <p>
            The plot below visualizes the learning progress at the 1st, 5th, and 20th iteration. The vehicle starts with few-shot non-expert demonstrations of driving,
            and gradually learns to drive faster and more aggressively. The vehicle is able to learn to drive at the limit of handling
            and converge to a consistent lap time.
          </p>
          <img src="static/images/fig_barc_trajectory.png" alt="Learning MPC with Error Dynamics Regression" style="width:70%;" class="is-centered">

          <p>
            We also did full-size experiments on profession autonomous race cars in the <a href="https://www.indyautonomouschallenge.com/">Indy Autonomous Challenge</a>.
            These autonomous race cars are capable of driving up to 340 km/h (200 mph). 
          </p>

          <iframe width="560" height="315" src="https://www.youtube.com/embed/I2nQbDTGlpA?si=ztN5lo6PvCDDWE_3" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
        </div>
      </div>
    </div>
    <!--/ LMPC basics -->

    <!-- LMPC basics -->
    <div class="columns is-centered">
      <div class="column is-full-width">
        <h2 class="title is-3", style="color: red;">Takeaways</h2>

        <div class="content has-text-justified">
          <p>
            The series of works on Learning MPC shows that
          </p>
          <ul>
            <li>MPC is a useful paradigm for real-world robot learning.</li>
            <li>A locally accurate dynamics may just be enough: we don't need to learn a globally expressive dynamics model.</li>
            <li>Iterative learning and exploration helps to mitigate the "chicken-and-egg" problem between high-quality data and good control policy in robot learning.</li>
        </div>
      </div>
    </div>
    <!--/ LMPC basics -->

    <!-- Concurrent Work. -->
    <div class="columns is-centered">
      <div class="column is-full-width">
        <h2 class="title is-3">Related Links</h2>

        <div class="content has-text-justified">
          <p>
            Check out previous works in Learning MPC at UC Berkeley's <a href="https://sites.google.com/berkeley.edu/lmpc/home?authuser=0">MPC Lab</a>.
          </p>
          <p>
            For exciting autonomous racing clips, check out <a href="https://youtube.com/playlist?list=PLuc9RFkF6rdLSjV7A2phDUyl5OpHjG9eT&si=fe5C6orL79xYQ-1u">Haoru's YouTube channel</a>.
          </p>
          <p>
            Learn more about the collaborative autonomous racing research between UC Berkeley, CMU, and UC San Diego at <a href="https://www.airacingtech.com/">AI Racing Tech</a>.
          </p>
        </div>
      </div>
    </div>
    <!--/ Concurrent Work. -->

  </div>
</section>


<section class="section" id="BibTeX">
  <div class="container is-max-desktop content">
    <h2 class="title">BibTeX</h2>
    <pre><code>@misc{xue2024learning,
      title={Learning Model Predictive Control with Error Dynamics Regression for Autonomous Racing}, 
      author={Haoru Xue and Edward L. Zhu and John M. Dolan and Francesco Borrelli},
      year={2024},
      eprint={2309.10716},
      archivePrefix={arXiv},
      primaryClass={cs.RO}
}</code></pre>
  </div>
</section>

<section class="section">
  <div class="container is-max-desktop">
    <h2 class="title is-3">The End</h2>
    <div class="content has-text-justified">
      <p>
        Some cool autonomous race car videos!
      </p>
      <iframe width="560" height="315" src="https://www.youtube.com/embed/zTl0JwnTcQw?si=vgXEJPkneZrVfxN5" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
    </div>
  </div>


<footer class="footer">
  <div class="container">
    <div class="columns is-centered">
      <div class="column is-8">
        <div class="content">
          <p>
            This website is licensed under a <a rel="license"
                                                href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
            Commons Attribution-ShareAlike 4.0 International License</a>.
          </p>
          <p>
            This amazing website template was obtained <a
              href="https://github.com/nerfies/nerfies.github.io">here</a>.
          </p>
        </div>
      </div>
    </div>
  </div>
</footer>

</body>
</html>
